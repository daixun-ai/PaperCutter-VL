## 问题说明

在使用 PaddleOCR-VL 导出 Markdown 结果时，**默认实现无法保留页眉（header）和页脚（footer）内容**。  
这是由于 `_to_markdown` 方法中会根据 `model_settings.markdown_ignore_labels` 对部分 block 进行过滤，`footer` 往往被当作噪声标签而被忽略，最终未写入 `markdown_texts`。

---

## 解决方式

可以直接修改 PaddleX 安装目录中的源码文件：
`envs/paddleocr-vl/lib/python3.12/site-packages/paddlex/inference/pipelines/paddleocr_vl/result.py`

通过调整 `_to_markdown` 方法的逻辑，**确保 `footer` 不会被从 Markdown 处理流程中移除**。

---

## 修改点说明

核心思路是：

- 不再直接按原逻辑无差别移除 `markdown_ignore_labels`
- 在过滤前，显式将 `"footer"` 从忽略列表中移除
- 其余逻辑保持不变，避免引入副作用

---

## 修改后的 `_to_markdown` 实现

```python
def _to_markdown(self, pretty=True, show_formula_number=False) -> dict:
    """
    Save the parsing result to a Markdown file.

    Args:
        pretty (Optional[bool]): whether to pretty markdown by HTML, default by True.
        show_formula_number (bool): whether to show formula numbers.

    Returns:
        dict: Markdown information with text and images.
    """
    original_image_width = self["doc_preprocessor_res"]["output_img"].shape[1]

    if pretty:
        format_text_func = lambda block: format_centered_by_html(
            format_text_plain_func(block)
        )
        format_image_func = lambda block: format_centered_by_html(
            format_image_scaled_by_html_func(
                block,
                original_image_width=original_image_width,
            )
        )
    else:
        format_text_func = lambda block: block.content
        format_image_func = format_image_plain_func

    format_chart_func = (
        format_chart2table_func
        if self["model_settings"]["use_chart_recognition"]
        else format_image_func
    )

    if pretty:
        format_table_func = lambda block: "\n" + format_table_center_func(block)
    else:
        format_table_func = lambda block: simplify_table_func("\n" + block.content)

    format_formula_func = lambda block: block.content
    format_seal_func = format_image_func

    handle_funcs_dict = build_handle_funcs_dict(
        text_func=format_text_func,
        image_func=format_image_func,
        chart_func=format_chart_func,
        table_func=format_table_func,
        formula_func=format_formula_func,
        seal_func=format_seal_func,
    )

    # -----------------------------
    # 方法1关键修改：确保footer不被忽略
    ignore_labels = self["model_settings"].get("markdown_ignore_labels", [])
    if "footer" in ignore_labels:
        ignore_labels.remove("footer")
    for label in ignore_labels:
        handle_funcs_dict.pop(label, None)
    # -----------------------------

    markdown_content = ""
    markdown_info = {}
    markdown_info["markdown_images"] = {}

    for idx, block in enumerate(self["parsing_res_list"]):
        label = block.label

        if block.image is not None:
            markdown_info["markdown_images"][block.image["path"]] = block.image["img"]

        handle_func = handle_funcs_dict.get(label, None)

        if (
            show_formula_number
            and label in ("display_formula", "formula")
            and idx != len(self["parsing_res_list"]) - 1
        ):
            next_block = self["parsing_res_list"][idx + 1]
            if next_block.label == "formula_number":
                block.content = merge_formula_and_number(
                    block.content, next_block.content
                )

        if handle_func:
            markdown_content += (
                "\n\n" + handle_func(block)
                if markdown_content
                else handle_func(block)
            )
    # -----------------------------
    # 方法2关键修改：循环最后强制追加 footer
    # for block in self["parsing_res_list"]:
    #     if block.label == "footer":
    #         markdown_content += "\n\n" + format_text_plain_func(block)
    # -----------------------------

    markdown_info["page_index"] = self["page_index"]
    markdown_info["input_path"] = self["input_path"]
    markdown_info["markdown_texts"] = markdown_content

    for img in self["imgs_in_doc"]:
        markdown_info["markdown_images"][img["path"]] = img["img"]

    return markdown_info
